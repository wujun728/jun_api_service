
<!DOCTYPE html>
<html>
<head>
<title>JFinal-RunApi-极速开发接口文档</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no" />
<link rel="icon" href="https://jfinal.com/assets/img/favicon.ico">
	<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
	<link rel="stylesheet" href="/assets/lib/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="/assets/css/common/global.css" media="all">
    <link rel="stylesheet" href="/assets/css/common/theme-default.css" media="all">
    <link rel="stylesheet" href="/assets/css/common/layui_extend.css" media="all">
    <link rel="stylesheet" href="/assets/css/runapi/doc-index.css">
	<link rel="stylesheet" href="/assets/css/runapi/doc-app.css" rel="stylesheet">
	<link rel="stylesheet" href="/assets/lib/layui_exts/mouseRightMenu/mouseRightMenu.css" />
	<script src="/assets/lib/jquery/jquery-2.1.4.min.js" type="text/javascript" ></script>
	<script src="/assets/lib/jquery/jquery.form.js" type="text/javascript" ></script>
    <script src="/assets/lib/layui/layui.js" type="text/javascript" ></script>
    <script src="/assets/lib/xm-select/xm-select.js" type="text/javascript" ></script>
    <!-- jquery 表格移动需要 -->
	<script src="/assets/lib/jquery/jquery-migrate-1.2.1.js"></script>
	<script src="/assets/lib/jquery/jquery-ui.min.js" type="text/javascript" ></script>
	
<style type="text/css">
.div-scroll{
	overflow:auto;
	border-top:1px solid #DCDCDC;
	border-left:1px solid #DCDCDC;
	border-bottom:1px solid #DCDCDC;
	min-width:345px;
	position: relative;
}
  .l-layout-header {
    position: relative;
    padding-left: 10px;
    color: #183152;
    font-weight: bold;
    height: 30px;
    line-height: 30px;
    background: #fff;
    border-bottom: 1px solid #eee;
    overflow: hidden;
    cursor: pointer;
}
.layui-form-item .layui-inline {
    margin-right: 0px;
}
.f-form .layui-inline {
    margin-top: 3px;
    margin-bottom: 0px;
}
#container{
   background: #ffffff;
}
.search-model {
    margin-bottom: 0px;
    padding: 0px;
}
.layui-container-fluid{
 background: #ffffff;
}
</style>
</head>
<body>
	<div class="layui-container-fluid">
		<div class="layui-row layui-col-space1 task-row">
		  <div class="layui-col-xs6 div-scroll">
			 <div class="l-layout-header"><span style="color:#16b777">系统管理员</span> 可选用户</div>
             <div class="l-scroll"style="left: 0px;top: 0px;">
<form class="layui-form layui-form-pane f-form layui-hide-xs" id='searchForm' lay-filter='searchForm' action="javascript:;">
	<div class='layui-row layui-col-space1 task-row search-model'>
		<div class='layui-col-xs12 layui-col-sm12 layui-col-md12'> 
			<div class="layui-form-item">
					<div class="layui-inline">																	
					   	<input type="search" name="userName" autocomplete="off" class="layui-input" placeholder="用户名"/>						
					</div>		
					<div class="layui-inline">								
					   	<input type="search" name="nickname" autocomplete="off" class="layui-input" placeholder="姓名"/>										
					</div>									
				<div class="layui-inline">
					<div class="layui-btn-group">
						<button class="layui-btn layui-btn-disabled " disabled id="searchBtn_">
							<i class="layui-icon">&#xe615;</i>查询
						</button>
						<button class="layui-btn layui-hide" type="reset" id="resetBtn" style="margin-left: 5px!important;">
							<i class="layui-icon layui-icon-close"></i>重置
						</button>
						<button class="layui-btn " type="reset" onclick="$('#resetBtn').click();$('#searchBtn_').click()" style="margin-left: 5px!important;">
							<i class="layui-icon layui-icon-close"></i>清空
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>
           		<table id="maingrid" lay-filter="maingrid"></table>
             </div>
		</div>
		  
		  <div class="layui-col-xs6 div-scroll">
		  	<div class="l-layout-header"><span style="color:#5FB878"></span> 已选用户</div>
		  	<div class="l-scroll"style="left: 0px;top: 0px;">
		  		<form class="layui-form layui-form-pane f-form" id='searchForm1' lay-filter='searchForm1' action="javascript:;">
					<div class='layui-row layui-col-space1 task-row search-model'>
						<div class='layui-col-xs12 '> 
							<div class="layui-form-item">
								<div class="layui-inline">																	
								   	<input type="search" name="userName" autocomplete="off" class="layui-input" placeholder="用户名"/>						
								</div>	
								<div class="layui-inline">									
								   	<input type="search" name="nickname" autocomplete="off" class="layui-input" placeholder="姓名"/>										
								</div>						
								<div class="layui-inline">
									<div class="layui-btn-group">
										<button class="layui-btn" style=" height: 30px; line-height: 30px;    border-radius: 3px !important; font-size: 13px; ">
											<i class="layui-icon">&#xe615;</i>查询
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</form>
           		<table id="maingrid1" lay-filter="maingrid1"></table>
             </div>
		</div>
	</div>
	<!-- 	每行的操作按钮 -->
	<script type="text/html" id="bar_maingrid">
  	<a class="layui-btn layui-btn-xs" lay-event="add">选择</a>
	</script>
	<script type="text/html" id="bar_maingrid1">
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="remove">移除</a>
	</script>
	</div>
	<script src="/assets/js/common/alert.js" type="text/javascript" ></script>
	<script src="/assets/js/common/ui.tool.js" type="text/javascript" ></script>
	<script src="/assets/js/common/grid-init.js" type="text/javascript" ></script>
	<script type="text/javascript">
		var _path='';
		//执行一个laydate日期选择控件实例
		lay('.layui-date').each(function(){
			layui.laydate.render({
			    elem: this
			    ,trigger:'click'
			});		  
		});
		
		//执行一个laydate日期时间控件实例
		lay('.layui-date-time').each(function(){
			layui.laydate.render({
			    elem: this
			    ,type:'datetime'
			    ,trigger:'click'
			});
		});

		//调取用户选择器,dataType:0单选，1多选
		function getUser(inputId,dataType){
	    	sessionStorage.setItem('inputId',inputId);
	    	var userIds=$('#'+inputId).val();
	    	var url='/portal/core/sysOrg/getUser?userIds='+userIds+'&dataType='+dataType;
	    	openDialog('选择用户',url,false,840,460,null);
	    }

	    //确定按钮回调函数
	    function getUserData(userDataList,dataType){
	    	var resultValue=new Array();
	    	var resultTitle=new Array();
	    	$.each(userDataList,function(index,value){
	        		if(dataType=='0'&&index>0){
						return
	            	}
	               resultValue.push(value.id);
	               resultTitle.push(value.user_name);
	        });
	        
	        var inputId=sessionStorage.getItem('inputId');
	        $('#'+inputId).val(resultValue.join(',')); 
	        $('#'+inputId+'_name').val(resultTitle.join(','));        
	              
	        if(inputId!=null)
	        	sessionStorage.removeItem('inputId');
	    }
	</script>
<!-- 分页表格 -->
<script>
	var num=0;
	var roleId="1";
	//选择用户
	 function addUser(obj){
		var data=obj.data;
		var userId=data.id;
		var url="/role/addUser";
		$.ajax({
			url
			,type:"POST"
			,data:{"roleId":roleId,"userId":userId}
			,success:function(data){				
				$(".layui-laypage-btn").click();
				if(num==0){
					queryRoleUserList();
				}				
				layer.msg(data.msg);
			}
		});
	 }
	 //移除用户
	 function removeUser(obj){
		var data=obj.data;
		var userId=data.id;
		var url="/role/deleteUser";
		$.ajax({
			url
			,type:"POST"
			,data:{"roleId":roleId,"userId":userId}
			,success:function(data){
				refreshData();	
				queryRoleUserList();		
				layer.msg(data.msg);
			}
		});
	 }

	
	//查询角色用户,是否重新渲染表格
	function queryRoleUserList(){
		var url="/role/userList";
		$.ajax({
			 url
			 ,type:"POST"
		     ,data:{"roleId":roleId}
			 ,success:function(data){
				 num=data.totalCount;
				 if(num<=1){					
					table.reload('maingrid1', {});
				 }
			}
		});
	}
	//未选用户列表
	gridArgs.title='用户';
	gridArgs.dataId='id';
	gridArgs.gridDivId ='maingrid';
	gridArgs.heightDiff =80;
	initGrid({id : 'maingrid'
			,elem : '#maingrid'
			,cellMinWidth: 80
			,cols : [ [
					{title:'序号',type:'numbers',width:35},						
					{title: '用户名', field: 'user_name',sort:true },
        			{title: '姓名', field: 'nickname',sort:true},																			
					{title: '操作',fixed:'right',width : 100,align : 'left',toolbar : '#bar_maingrid'}
			] ]
			,url:"/role/userListNotInRoleId.json"
			,where:{"roleId":roleId}
			,searchForm : 'searchForm'
		},{add:addUser});
	
	//已选用户列表
	initGrid({id : 'maingrid1'
			,elem : '#maingrid1'
			,cellMinWidth: 80
			,cols : [ [
					{title:'序号',type:'numbers',width:35},					
					{title: '用户名', field: 'user_name',sort:true },
        			{title: '姓名', field: 'nickname',sort:true},																
					{title: '操作',fixed:'right',width : 100,align : 'left',toolbar : '#bar_maingrid1'} 
			] ]
			,url:"/role/userList.json"
			,where:{"roleId":roleId}
			,searchForm : 'searchForm1'
		},{remove:removeUser});
	
</script>
</body>
</html>


  